#!/usr/bin/env node

const fs = require("fs");
const path = require("path");
const cmd = require("commander");

const OloWiki = require("../index");
const olowiki = new OloWiki( process.cwd() );

const cli = cmd.version(OloWiki.getVersion(), "-v --version");

cli.command("start [port]")
   .description("Start the olowiki server.")
   .action(port => olowiki.start(port));
   
cli.command("init <ownerId> [smtpURL]")
   .description("Initialize a new olowiki instance in the working directory.")
   .action((ownerId, smtpURL) => olowiki.init(ownerId, smtpURL));

cli.command("set-smtp <host> <port> <user> <password>")
  .description("Configure the access parameters for the SMTP server used to send identity tokens to users.")
  .action((host, port, user, password) => olowiki.setSMTP(host, port, user, password));
   

cli.command("gen-token <user> [attributes...]")
   .description("Generate and identity token for the passed user name.")
   .action((userId, attributes) => {
       const token = olowiki.generateToken(userId, attributes);
       console.log(token);
   });

cli.command("parse-token <toekn>")
  .description("Verifies a user token and displays its payload.")
  .action((token) => {
      const user = olowiki.parseToken(token);
      console.log({
          id: user.id,
          attributes: user.attributes
      });
  });


cli.parse( process.argv );
